import streamlit as st
import random
from streamlit_extras.metric_cards import style_metric_cards

# -----------------------------
# MOCK DATABASE
# -----------------------------
products = [
    {
        "id": "prod_001",
        "name": "‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå",
        "category": "‡∏Ç‡πâ‡∏≤‡∏ß",
        "region": "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ",
        "price": 45,
        "seller": "‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏≤",
        "trace": "‡∏õ‡∏•‡∏π‡∏Å‡∏ó‡∏µ‡πà ‡∏≠‡∏∏‡∏ö‡∏•‡∏Ø | ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß 1 ‡∏û.‡∏Ñ. 2025 | ‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á Organic"
    },
    {
        "id": "prod_002",
        "name": "‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡∏ï‡∏≤‡∏Å‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå",
        "category": "‡∏ú‡∏•‡πÑ‡∏°‡πâ‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ",
        "region": "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å",
        "price": 35,
        "seller": "‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏•‡∏≠‡∏á",
        "trace": "‡∏õ‡∏•‡∏π‡∏Å‡∏ó‡∏µ‡πà ‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å | ‡∏ï‡∏≤‡∏Å 15 ‡∏°‡∏¥.‡∏¢. 2025 | ‡∏õ‡∏•‡∏≠‡∏î‡∏™‡∏≤‡∏£"
    }
]

cart = []
user_profile = {
    "username": "demo_user",
    "coins": 100,
    "order_history": [],
    "role": "Customer"
}

# -----------------------------
# FUNCTION DEFINITIONS
# -----------------------------
def add_to_cart(product):
    cart.append(product)
    st.success(f"‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° '{product['name']}' ‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß")

def place_order():
    if not cart:
        st.warning("üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°")
        return
    st.success("üéâ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 10 Coins")
    user_profile["coins"] += 10
    user_profile["order_history"].extend(cart)
    cart.clear()

def recommend_products():
    if not user_profile["order_history"]:
        return products
    keywords = [item["category"] for item in user_profile["order_history"]]
    return [p for p in products if p["category"] in keywords]

# -----------------------------
# SIDEBAR
# -----------------------------
st.set_page_config(page_title="Local Hub", layout="centered")
st.sidebar.title("üçÉ Local Hub")
st.sidebar.write(f"üë§ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: `{user_profile['username']}`")
st.sidebar.metric(label="üí∞ Coins", value=user_profile['coins'])
style_metric_cards()

page = st.sidebar.radio("üìå ‡πÄ‡∏°‡∏ô‡∏π", ["‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å", "‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤", "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠", "‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢", "‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô"])

# -----------------------------
# PAGE: ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
# -----------------------------
if page == "‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å":
    st.title("üõçÔ∏è ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å‡∏ä‡∏∏‡∏°‡∏ä‡∏ô")
    st.markdown("---")
    for product in recommend_products():
        with st.container():
            st.subheader(f"üì¶ {product['name']}")
            st.caption(f"‡∏´‡∏°‡∏ß‡∏î: {product['category']} | ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: {product['region']}")
            st.write(f"üí∏ ‡∏£‡∏≤‡∏Ñ‡∏≤: **{product['price']} ‡∏ö‡∏≤‡∏ó**")
            st.write(f"üë©‚Äçüåæ ‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï: _{product['seller']}_")
            col1, col2 = st.columns(2)
            with col1:
                if st.button(f"üîç ‡∏î‡∏π QR ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á - {product['id']}"):
                    st.info(f"üîó {product['trace']}")
            with col2:
                if st.button(f"üõí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ - {product['id']}"):
                    add_to_cart(product)
            st.markdown("---")

# -----------------------------
# PAGE: ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
# -----------------------------
elif page == "‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤":
    st.title("üß∫ ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì")
    st.markdown("---")
    if not cart:
        st.info("üî∏ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤")
    else:
        total = sum([item["price"] for item in cart])
        for item in cart:
            st.write(f"- üõçÔ∏è {item['name']} ({item['price']} ‡∏ö‡∏≤‡∏ó)")
        st.markdown(f"**‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: {total} ‡∏ö‡∏≤‡∏ó**")
        if st.button("‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠"):
            place_order()

# -----------------------------
# PAGE: ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
# -----------------------------
elif page == "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠":
    st.title("üì¶ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤")
    st.markdown("---")
    if not user_profile["order_history"]:
        st.info("üì≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠")
    else:
        for item in user_profile["order_history"]:
            st.write(f"‚úÖ {item['name']} ({item['price']} ‡∏ö‡∏≤‡∏ó)")

# -----------------------------
# PAGE: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (Mock)
# -----------------------------
elif page == "‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢":
    st.title("üë©‚Äçüåæ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (‡∏à‡∏≥‡∏•‡∏≠‡∏á)")
    st.markdown("---")
    st.info("üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)")
    st.text_input("üìå ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà")
    st.text_input("üí∏ ‡∏£‡∏≤‡∏Ñ‡∏≤")
    st.button("‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏à‡∏≥‡∏•‡∏≠‡∏á)")

# -----------------------------
# PAGE: ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (Mock)
# -----------------------------
elif page == "‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô":
    st.title("üõ°Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (‡∏à‡∏≥‡∏•‡∏≠‡∏á)")
    st.markdown("---")
    st.info("üß∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)")
    st.button("üì• ‡∏î‡∏π‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥")
    st.button("üö® ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤")
